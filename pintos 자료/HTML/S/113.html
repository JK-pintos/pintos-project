<html>
<head>
<title>src/lib/kernel/hash.c</title>
<meta name='robots' content='noindex,nofollow'>
<meta name='generator' content='GLOBAL-5.7.1'>
</head>
<body text='#191970' bgcolor='#f5f5dc' vlink='gray'>
<a name='TOP'><h2><a href='../mains.html'>root</a>/<a href='../files/595.html'>src</a>/<a href='../files/599.html'>lib</a>/<a href='../files/600.html'>kernel</a>/hash.c</h2>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L25'>[^]</a><a href='#L425'>[v]</a>[top]<a href='#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
<hr>
<h2>DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href='#L25' title='Defined at 25.'>hash_init</a>
<li><a href='#L54' title='Defined at 54.'>hash_clear</a>
<li><a href='#L87' title='Defined at 87.'>hash_destroy</a>
<li><a href='#L99' title='Defined at 99.'>hash_insert</a>
<li><a href='#L115' title='Defined at 115.'>hash_replace</a>
<li><a href='#L132' title='Defined at 132.'>hash_find</a>
<li><a href='#L145' title='Defined at 145.'>hash_delete</a>
<li><a href='#L163' title='Defined at 163.'>hash_apply</a>
<li><a href='#L200' title='Defined at 200.'>hash_first</a>
<li><a href='#L219' title='Defined at 219.'>hash_next</a>
<li><a href='#L241' title='Defined at 241.'>hash_cur</a>
<li><a href='#L248' title='Defined at 248.'>hash_size</a>
<li><a href='#L255' title='Defined at 255.'>hash_empty</a>
<li><a href='#L266' title='Defined at 266.'>hash_bytes</a>
<li><a href='#L283' title='Defined at 283.'>hash_string</a>
<li><a href='#L299' title='Defined at 299.'>hash_int</a>
<li><a href='#L306' title='Defined at 306.'>find_bucket</a>
<li><a href='#L315' title='Defined at 315.'>find_elem</a>
<li><a href='#L330' title='Defined at 330.'>turn_off_least_1bit</a>
<li><a href='#L337' title='Defined at 337.'>is_power_of_2</a>
<li><a href='#L352' title='Defined at 352.'>rehash</a>
<li><a href='#L417' title='Defined at 417.'>insert_elem</a>
<li><a href='#L425' title='Defined at 425.'>remove_elem</a>
</ol>
<hr>
<pre>
<a name='L1'>   1 <i><font color='green'>/* Hash table.</font></i>
<a name='L2'>   2 <i><font color='green'></font></i>
<a name='L3'>   3 <i><font color='green'>   This data structure is thoroughly documented in the Tour of</font></i>
<a name='L4'>   4 <i><font color='green'>   Pintos for Project 3.</font></i>
<a name='L5'>   5 <i><font color='green'></font></i>
<a name='L6'>   6 <i><font color='green'>   See hash.h for basic information. */</font></i>
<a name='L7'>   7 
<a name='L8'>   8 <font color='darkred'>#include</font> "<a href='108.html'>hash.h</a>"
<a name='L9'>   9 <font color='darkred'>#include</font> "<a href='104.html'>../debug.h</a>"
<a name='L10'>  10 <font color='darkred'>#include</font> "<a href='149.html'>threads/malloc.h</a>"
<a name='L11'>  11 
<a name='L12'>  12 <font color='darkred'>#define</font> <a href='../R/596.html' title='Multiple refered from 8 places.'>list_elem_to_hash_elem</a>(LIST_ELEM)                       \
<a name='L13'>  13         <a href='../S/107.html#L108' title='Defined at 108 in src/lib/kernel/list.h.'>list_entry</a>(LIST_ELEM, <b>struct</b> <a href='../S/108.html#L29' title='Defined at 29 in src/lib/kernel/hash.h.'>hash_elem</a>, <a href='../S/107.html#L90' title='Defined at 90 in src/lib/kernel/list.h.'>list_elem</a>)
<a name='L14'>  14 
<a name='L15'>  15 <b>static</b> <b>struct</b> <a href='../S/107.html#L97' title='Defined at 97 in src/lib/kernel/list.h.'>list</a> *<a href='../S/113.html#L306' title='Defined at 306 in src/lib/kernel/hash.c.'>find_bucket</a> (<b>struct</b> hash *, <b>struct</b> hash_elem *);
<a name='L16'>  16 <b>static</b> <b>struct</b> <a href='../S/108.html#L29' title='Defined at 29 in src/lib/kernel/hash.h.'>hash_elem</a> *<a href='../S/113.html#L315' title='Defined at 315 in src/lib/kernel/hash.c.'>find_elem</a> (<b>struct</b> hash *, <b>struct</b> list *,
<a name='L17'>  17                                     <b>struct</b> hash_elem *);
<a name='L18'>  18 <b>static</b> <b>void</b> <a href='../S/113.html#L417' title='Defined at 417 in src/lib/kernel/hash.c.'>insert_elem</a> (<b>struct</b> hash *, <b>struct</b> list *, <b>struct</b> hash_elem *);
<a name='L19'>  19 <b>static</b> <b>void</b> <a href='../S/113.html#L425' title='Defined at 425 in src/lib/kernel/hash.c.'>remove_elem</a> (<b>struct</b> hash *, <b>struct</b> hash_elem *);
<a name='L20'>  20 <b>static</b> <b>void</b> <a href='../S/113.html#L352' title='Defined at 352 in src/lib/kernel/hash.c.'>rehash</a> (<b>struct</b> hash *);
<a name='L21'>  21 
<a name='L22'>  22 <i><font color='green'>/* Initializes hash table H to compute hash values using HASH and</font></i>
<a name='L23'>  23 <i><font color='green'>   compare hash elements using LESS, given auxiliary data AUX. */</font></i>
<a name='L24'>  24 <a href='../S/78.html#L4' title='Defined at 4 in src/lib/stdbool.h.'>bool</a>
<a name='L25'>  25 <a href='../S/108.html#L78' title='Refered from 78 in src/lib/kernel/hash.h.'>hash_init</a> (<b>struct</b> hash *h,
<a name='L26'>  26            hash_hash_func *hash, hash_less_func *less, <b>void</b> *aux) 
<a name='L27'>  27 <font color='red'>{</font>
<a name='L28'>  28   h-&gt;<a href='../S/114.html#L51' title='Defined at 51 in src/lib/kernel/bitmap.c.'>elem_cnt</a> = 0;
<a name='L29'>  29   h-&gt;bucket_cnt = 4;
<a name='L30'>  30   h-&gt;buckets = <a href='../S/161.html#L90' title='Defined at 90 in src/threads/malloc.c.'>malloc</a> (<b>sizeof</b> *h-&gt;buckets * h-&gt;bucket_cnt);
<a name='L31'>  31   h-&gt;<a href='../S/108.html#L59' title='Defined at 59 in src/lib/kernel/hash.h.'>hash</a> = <a href='../S/108.html#L59' title='Defined at 59 in src/lib/kernel/hash.h.'>hash</a>;
<a name='L32'>  32   h-&gt;less = less;
<a name='L33'>  33   h-&gt;aux = aux;
<a name='L34'>  34 
<a name='L35'>  35   <b>if</b> (h-&gt;buckets != <a href='../S/92.html#L4' title='Defined at 4 in src/lib/stddef.h.'>NULL</a>) 
<a name='L36'>  36     <font color='red'>{</font>
<a name='L37'>  37       <a href='../S/113.html#L54' title='Defined at 54 in src/lib/kernel/hash.c.'>hash_clear</a> (h, <a href='../S/92.html#L4' title='Defined at 4 in src/lib/stddef.h.'>NULL</a>);
<a name='L38'>  38       <b>return</b> <a href='../S/78.html#L5' title='Defined at 5 in src/lib/stdbool.h.'>true</a>;
<a name='L39'>  39     <font color='red'>}</font>
<a name='L40'>  40   <b>else</b>
<a name='L41'>  41     <b>return</b> <a href='../S/78.html#L6' title='Defined at 6 in src/lib/stdbool.h.'>false</a>;
<a name='L42'>  42 <font color='red'>}</font>
<a name='L43'>  43 
<a name='L44'>  44 <i><font color='green'>/* Removes all the elements from H.</font></i>
<a name='L45'>  45 <i><font color='green'>   </font></i>
<a name='L46'>  46 <i><font color='green'>   If DESTRUCTOR is non-null, then it is called for each element</font></i>
<a name='L47'>  47 <i><font color='green'>   in the hash.  DESTRUCTOR may, if appropriate, deallocate the</font></i>
<a name='L48'>  48 <i><font color='green'>   memory used by the hash element.  However, modifying hash</font></i>
<a name='L49'>  49 <i><font color='green'>   table H while hash_clear() is running, using any of the</font></i>
<a name='L50'>  50 <i><font color='green'>   functions hash_clear(), hash_destroy(), hash_insert(),</font></i>
<a name='L51'>  51 <i><font color='green'>   hash_replace(), or hash_delete(), yields undefined behavior,</font></i>
<a name='L52'>  52 <i><font color='green'>   whether done in DESTRUCTOR or elsewhere. */</font></i>
<a name='L53'>  53 <b>void</b>
<a name='L54'>  54 <a href='../R/477.html' title='Multiple refered from 3 places.'>hash_clear</a> (<b>struct</b> hash *h, hash_action_func *destructor) 
<a name='L55'>  55 <font color='red'>{</font>
<a name='L56'>  56   <a href='../S/92.html#L10' title='Defined at 10 in src/lib/stddef.h.'>size_t</a> i;
<a name='L57'>  57 
<a name='L58'>  58   <b>for</b> (i = 0; i &lt; h-&gt;bucket_cnt; i++) 
<a name='L59'>  59     <font color='red'>{</font>
<a name='L60'>  60       <b>struct</b> <a href='../S/107.html#L97' title='Defined at 97 in src/lib/kernel/list.h.'>list</a> *bucket = &amp;h-&gt;buckets[i];
<a name='L61'>  61 
<a name='L62'>  62       <b>if</b> (destructor != <a href='../S/92.html#L4' title='Defined at 4 in src/lib/stddef.h.'>NULL</a>) 
<a name='L63'>  63         <b>while</b> (!<a href='../S/112.html#L310' title='Defined at 310 in src/lib/kernel/list.c.'>list_empty</a> (bucket)) 
<a name='L64'>  64           <font color='red'>{</font>
<a name='L65'>  65             <b>struct</b> <a href='../S/107.html#L90' title='Defined at 90 in src/lib/kernel/list.h.'>list_elem</a> *<a href='../S/107.html#L90' title='Defined at 90 in src/lib/kernel/list.h.'>list_elem</a> = <a href='../S/112.html#L260' title='Defined at 260 in src/lib/kernel/list.c.'>list_pop_front</a> (bucket);
<a name='L66'>  66             <b>struct</b> <a href='../S/108.html#L29' title='Defined at 29 in src/lib/kernel/hash.h.'>hash_elem</a> *<a href='../S/108.html#L29' title='Defined at 29 in src/lib/kernel/hash.h.'>hash_elem</a> = <a href='../S/113.html#L12' title='Defined at 12 in src/lib/kernel/hash.c.'>list_elem_to_hash_elem</a> (<a href='../S/107.html#L90' title='Defined at 90 in src/lib/kernel/list.h.'>list_elem</a>);
<a name='L67'>  67             destructor (<a href='../S/108.html#L29' title='Defined at 29 in src/lib/kernel/hash.h.'>hash_elem</a>, h-&gt;aux);
<a name='L68'>  68           <font color='red'>}</font>
<a name='L69'>  69 
<a name='L70'>  70       <a href='../S/112.html#L61' title='Defined at 61 in src/lib/kernel/list.c.'>list_init</a> (bucket); 
<a name='L71'>  71     <font color='red'>}</font>    
<a name='L72'>  72 
<a name='L73'>  73   h-&gt;<a href='../S/114.html#L51' title='Defined at 51 in src/lib/kernel/bitmap.c.'>elem_cnt</a> = 0;
<a name='L74'>  74 <font color='red'>}</font>
<a name='L75'>  75 
<a name='L76'>  76 <i><font color='green'>/* Destroys hash table H.</font></i>
<a name='L77'>  77 <i><font color='green'></font></i>
<a name='L78'>  78 <i><font color='green'>   If DESTRUCTOR is non-null, then it is first called for each</font></i>
<a name='L79'>  79 <i><font color='green'>   element in the hash.  DESTRUCTOR may, if appropriate,</font></i>
<a name='L80'>  80 <i><font color='green'>   deallocate the memory used by the hash element.  However,</font></i>
<a name='L81'>  81 <i><font color='green'>   modifying hash table H while hash_clear() is running, using</font></i>
<a name='L82'>  82 <i><font color='green'>   any of the functions hash_clear(), hash_destroy(),</font></i>
<a name='L83'>  83 <i><font color='green'>   hash_insert(), hash_replace(), or hash_delete(), yields</font></i>
<a name='L84'>  84 <i><font color='green'>   undefined behavior, whether done in DESTRUCTOR or</font></i>
<a name='L85'>  85 <i><font color='green'>   elsewhere. */</font></i>
<a name='L86'>  86 <b>void</b>
<a name='L87'>  87 <a href='../S/108.html#L80' title='Refered from 80 in src/lib/kernel/hash.h.'>hash_destroy</a> (<b>struct</b> hash *h, hash_action_func *destructor) 
<a name='L88'>  88 <font color='red'>{</font>
<a name='L89'>  89   <b>if</b> (destructor != <a href='../S/92.html#L4' title='Defined at 4 in src/lib/stddef.h.'>NULL</a>)
<a name='L90'>  90     <a href='../S/113.html#L54' title='Defined at 54 in src/lib/kernel/hash.c.'>hash_clear</a> (h, destructor);
<a name='L91'>  91   <a href='../S/161.html#L219' title='Defined at 219 in src/threads/malloc.c.'>free</a> (h-&gt;buckets);
<a name='L92'>  92 <font color='red'>}</font>
<a name='L93'>  93 
<a name='L94'>  94 <i><font color='green'>/* Inserts NEW into hash table H and returns a null pointer, if</font></i>
<a name='L95'>  95 <i><font color='green'>   no equal element is already in the table.</font></i>
<a name='L96'>  96 <i><font color='green'>   If an equal element is already in the table, returns it</font></i>
<a name='L97'>  97 <i><font color='green'>   without inserting NEW. */</font></i>   
<a name='L98'>  98 <b>struct</b> <a href='../S/108.html#L29' title='Defined at 29 in src/lib/kernel/hash.h.'>hash_elem</a> *
<a name='L99'>  99 <a href='../S/108.html#L83' title='Refered from 83 in src/lib/kernel/hash.h.'>hash_insert</a> (<b>struct</b> hash *h, <b>struct</b> hash_elem *new)
<a name='L100'> 100 <font color='red'>{</font>
<a name='L101'> 101   <b>struct</b> <a href='../S/107.html#L97' title='Defined at 97 in src/lib/kernel/list.h.'>list</a> *bucket = <a href='../S/113.html#L306' title='Defined at 306 in src/lib/kernel/hash.c.'>find_bucket</a> (h, new);
<a name='L102'> 102   <b>struct</b> <a href='../S/108.html#L29' title='Defined at 29 in src/lib/kernel/hash.h.'>hash_elem</a> *old = <a href='../S/113.html#L315' title='Defined at 315 in src/lib/kernel/hash.c.'>find_elem</a> (h, bucket, new);
<a name='L103'> 103 
<a name='L104'> 104   <b>if</b> (old == <a href='../S/92.html#L4' title='Defined at 4 in src/lib/stddef.h.'>NULL</a>) 
<a name='L105'> 105     <a href='../S/113.html#L417' title='Defined at 417 in src/lib/kernel/hash.c.'>insert_elem</a> (h, bucket, new);
<a name='L106'> 106 
<a name='L107'> 107   <a href='../S/113.html#L352' title='Defined at 352 in src/lib/kernel/hash.c.'>rehash</a> (h);
<a name='L108'> 108 
<a name='L109'> 109   <b>return</b> old; 
<a name='L110'> 110 <font color='red'>}</font>
<a name='L111'> 111 
<a name='L112'> 112 <i><font color='green'>/* Inserts NEW into hash table H, replacing any equal element</font></i>
<a name='L113'> 113 <i><font color='green'>   already in the table, which is returned. */</font></i>
<a name='L114'> 114 <b>struct</b> <a href='../S/108.html#L29' title='Defined at 29 in src/lib/kernel/hash.h.'>hash_elem</a> *
<a name='L115'> 115 <a href='../S/108.html#L84' title='Refered from 84 in src/lib/kernel/hash.h.'>hash_replace</a> (<b>struct</b> hash *h, <b>struct</b> hash_elem *new) 
<a name='L116'> 116 <font color='red'>{</font>
<a name='L117'> 117   <b>struct</b> <a href='../S/107.html#L97' title='Defined at 97 in src/lib/kernel/list.h.'>list</a> *bucket = <a href='../S/113.html#L306' title='Defined at 306 in src/lib/kernel/hash.c.'>find_bucket</a> (h, new);
<a name='L118'> 118   <b>struct</b> <a href='../S/108.html#L29' title='Defined at 29 in src/lib/kernel/hash.h.'>hash_elem</a> *old = <a href='../S/113.html#L315' title='Defined at 315 in src/lib/kernel/hash.c.'>find_elem</a> (h, bucket, new);
<a name='L119'> 119 
<a name='L120'> 120   <b>if</b> (old != <a href='../S/92.html#L4' title='Defined at 4 in src/lib/stddef.h.'>NULL</a>)
<a name='L121'> 121     <a href='../S/113.html#L425' title='Defined at 425 in src/lib/kernel/hash.c.'>remove_elem</a> (h, old);
<a name='L122'> 122   <a href='../S/113.html#L417' title='Defined at 417 in src/lib/kernel/hash.c.'>insert_elem</a> (h, bucket, new);
<a name='L123'> 123 
<a name='L124'> 124   <a href='../S/113.html#L352' title='Defined at 352 in src/lib/kernel/hash.c.'>rehash</a> (h);
<a name='L125'> 125 
<a name='L126'> 126   <b>return</b> old;
<a name='L127'> 127 <font color='red'>}</font>
<a name='L128'> 128 
<a name='L129'> 129 <i><font color='green'>/* Finds and returns an element equal to E in hash table H, or a</font></i>
<a name='L130'> 130 <i><font color='green'>   null pointer if no equal element exists in the table. */</font></i>
<a name='L131'> 131 <b>struct</b> <a href='../S/108.html#L29' title='Defined at 29 in src/lib/kernel/hash.h.'>hash_elem</a> *
<a name='L132'> 132 <a href='../S/108.html#L85' title='Refered from 85 in src/lib/kernel/hash.h.'>hash_find</a> (<b>struct</b> hash *h, <b>struct</b> hash_elem *e) 
<a name='L133'> 133 <font color='red'>{</font>
<a name='L134'> 134   <b>return</b> <a href='../S/113.html#L315' title='Defined at 315 in src/lib/kernel/hash.c.'>find_elem</a> (h, <a href='../S/113.html#L306' title='Defined at 306 in src/lib/kernel/hash.c.'>find_bucket</a> (h, e), e);
<a name='L135'> 135 <font color='red'>}</font>
<a name='L136'> 136 
<a name='L137'> 137 <i><font color='green'>/* Finds, removes, and returns an element equal to E in hash</font></i>
<a name='L138'> 138 <i><font color='green'>   table H.  Returns a null pointer if no equal element existed</font></i>
<a name='L139'> 139 <i><font color='green'>   in the table.</font></i>
<a name='L140'> 140 <i><font color='green'></font></i>
<a name='L141'> 141 <i><font color='green'>   If the elements of the hash table are dynamically allocated,</font></i>
<a name='L142'> 142 <i><font color='green'>   or own resources that are, then it is the caller's</font></i>
<a name='L143'> 143 <i><font color='green'>   responsibility to deallocate them. */</font></i>
<a name='L144'> 144 <b>struct</b> <a href='../S/108.html#L29' title='Defined at 29 in src/lib/kernel/hash.h.'>hash_elem</a> *
<a name='L145'> 145 <a href='../S/108.html#L86' title='Refered from 86 in src/lib/kernel/hash.h.'>hash_delete</a> (<b>struct</b> hash *h, <b>struct</b> hash_elem *e)
<a name='L146'> 146 <font color='red'>{</font>
<a name='L147'> 147   <b>struct</b> <a href='../S/108.html#L29' title='Defined at 29 in src/lib/kernel/hash.h.'>hash_elem</a> *found = <a href='../S/113.html#L315' title='Defined at 315 in src/lib/kernel/hash.c.'>find_elem</a> (h, <a href='../S/113.html#L306' title='Defined at 306 in src/lib/kernel/hash.c.'>find_bucket</a> (h, e), e);
<a name='L148'> 148   <b>if</b> (found != <a href='../S/92.html#L4' title='Defined at 4 in src/lib/stddef.h.'>NULL</a>) 
<a name='L149'> 149     <font color='red'>{</font>
<a name='L150'> 150       <a href='../S/113.html#L425' title='Defined at 425 in src/lib/kernel/hash.c.'>remove_elem</a> (h, found);
<a name='L151'> 151       <a href='../S/113.html#L352' title='Defined at 352 in src/lib/kernel/hash.c.'>rehash</a> (h); 
<a name='L152'> 152     <font color='red'>}</font>
<a name='L153'> 153   <b>return</b> found;
<a name='L154'> 154 <font color='red'>}</font>
<a name='L155'> 155 
<a name='L156'> 156 <i><font color='green'>/* Calls ACTION for each element in hash table H in arbitrary</font></i>
<a name='L157'> 157 <i><font color='green'>   order. </font></i>
<a name='L158'> 158 <i><font color='green'>   Modifying hash table H while hash_apply() is running, using</font></i>
<a name='L159'> 159 <i><font color='green'>   any of the functions hash_clear(), hash_destroy(),</font></i>
<a name='L160'> 160 <i><font color='green'>   hash_insert(), hash_replace(), or hash_delete(), yields</font></i>
<a name='L161'> 161 <i><font color='green'>   undefined behavior, whether done from ACTION or elsewhere. */</font></i>
<a name='L162'> 162 <b>void</b>
<a name='L163'> 163 <a href='../S/108.html#L89' title='Refered from 89 in src/lib/kernel/hash.h.'>hash_apply</a> (<b>struct</b> hash *h, hash_action_func *action) 
<a name='L164'> 164 <font color='red'>{</font>
<a name='L165'> 165   <a href='../S/92.html#L10' title='Defined at 10 in src/lib/stddef.h.'>size_t</a> i;
<a name='L166'> 166   
<a name='L167'> 167   <a href='../S/104.html#L37' title='Defined at 37 in src/lib/debug.h.'>ASSERT</a> (<a href='../S/156.html#L301' title='Defined at 301 in src/threads/init.c.'>action</a> != <a href='../S/92.html#L4' title='Defined at 4 in src/lib/stddef.h.'>NULL</a>);
<a name='L168'> 168 
<a name='L169'> 169   <b>for</b> (i = 0; i &lt; h-&gt;bucket_cnt; i++) 
<a name='L170'> 170     <font color='red'>{</font>
<a name='L171'> 171       <b>struct</b> <a href='../S/107.html#L97' title='Defined at 97 in src/lib/kernel/list.h.'>list</a> *bucket = &amp;h-&gt;buckets[i];
<a name='L172'> 172       <b>struct</b> <a href='../S/107.html#L90' title='Defined at 90 in src/lib/kernel/list.h.'>list_elem</a> *elem, *<a href='../S/135.html#L79' title='Defined at 79 in src/devices/intq.c.'>next</a>;
<a name='L173'> 173 
<a name='L174'> 174       <b>for</b> (elem = <a href='../S/112.html#L72' title='Defined at 72 in src/lib/kernel/list.c.'>list_begin</a> (bucket); elem != <a href='../S/112.html#L94' title='Defined at 94 in src/lib/kernel/list.c.'>list_end</a> (bucket); elem = <a href='../S/135.html#L79' title='Defined at 79 in src/devices/intq.c.'>next</a>) 
<a name='L175'> 175         <font color='red'>{</font>
<a name='L176'> 176           <a href='../S/135.html#L79' title='Defined at 79 in src/devices/intq.c.'>next</a> = <a href='../S/112.html#L82' title='Defined at 82 in src/lib/kernel/list.c.'>list_next</a> (elem);
<a name='L177'> 177           <a href='../S/156.html#L301' title='Defined at 301 in src/threads/init.c.'>action</a> (<a href='../S/113.html#L12' title='Defined at 12 in src/lib/kernel/hash.c.'>list_elem_to_hash_elem</a> (elem), h-&gt;aux);
<a name='L178'> 178         <font color='red'>}</font>
<a name='L179'> 179     <font color='red'>}</font>
<a name='L180'> 180 <font color='red'>}</font>
<a name='L181'> 181 
<a name='L182'> 182 <i><font color='green'>/* Initializes I for iterating hash table H.</font></i>
<a name='L183'> 183 <i><font color='green'></font></i>
<a name='L184'> 184 <i><font color='green'>   Iteration idiom:</font></i>
<a name='L185'> 185 <i><font color='green'></font></i>
<a name='L186'> 186 <i><font color='green'>      struct hash_iterator i;</font></i>
<a name='L187'> 187 <i><font color='green'></font></i>
<a name='L188'> 188 <i><font color='green'>      hash_first (&amp;i, h);</font></i>
<a name='L189'> 189 <i><font color='green'>      while (hash_next (&amp;i))</font></i>
<a name='L190'> 190 <i><font color='green'>        {</font></i>
<a name='L191'> 191 <i><font color='green'>          struct foo *f = hash_entry (hash_cur (&amp;i), struct foo, elem);</font></i>
<a name='L192'> 192 <i><font color='green'>          ...do something with f...</font></i>
<a name='L193'> 193 <i><font color='green'>        }</font></i>
<a name='L194'> 194 <i><font color='green'></font></i>
<a name='L195'> 195 <i><font color='green'>   Modifying hash table H during iteration, using any of the</font></i>
<a name='L196'> 196 <i><font color='green'>   functions hash_clear(), hash_destroy(), hash_insert(),</font></i>
<a name='L197'> 197 <i><font color='green'>   hash_replace(), or hash_delete(), invalidates all</font></i>
<a name='L198'> 198 <i><font color='green'>   iterators. */</font></i>
<a name='L199'> 199 <b>void</b>
<a name='L200'> 200 <a href='../S/108.html#L90' title='Refered from 90 in src/lib/kernel/hash.h.'>hash_first</a> (<b>struct</b> hash_iterator *i, <b>struct</b> hash *h) 
<a name='L201'> 201 <font color='red'>{</font>
<a name='L202'> 202   <a href='../S/104.html#L37' title='Defined at 37 in src/lib/debug.h.'>ASSERT</a> (i != <a href='../S/92.html#L4' title='Defined at 4 in src/lib/stddef.h.'>NULL</a>);
<a name='L203'> 203   <a href='../S/104.html#L37' title='Defined at 37 in src/lib/debug.h.'>ASSERT</a> (h != <a href='../S/92.html#L4' title='Defined at 4 in src/lib/stddef.h.'>NULL</a>);
<a name='L204'> 204 
<a name='L205'> 205   i-&gt;<a href='../S/108.html#L59' title='Defined at 59 in src/lib/kernel/hash.h.'>hash</a> = h;
<a name='L206'> 206   i-&gt;bucket = i-&gt;<a href='../S/108.html#L59' title='Defined at 59 in src/lib/kernel/hash.h.'>hash</a>-&gt;buckets;
<a name='L207'> 207   i-&gt;elem = <a href='../S/113.html#L12' title='Defined at 12 in src/lib/kernel/hash.c.'>list_elem_to_hash_elem</a> (<a href='../S/112.html#L151' title='Defined at 151 in src/lib/kernel/list.c.'>list_head</a> (i-&gt;bucket));
<a name='L208'> 208 <font color='red'>}</font>
<a name='L209'> 209 
<a name='L210'> 210 <i><font color='green'>/* Advances I to the next element in the hash table and returns</font></i>
<a name='L211'> 211 <i><font color='green'>   it.  Returns a null pointer if no elements are left.  Elements</font></i>
<a name='L212'> 212 <i><font color='green'>   are returned in arbitrary order.</font></i>
<a name='L213'> 213 <i><font color='green'></font></i>
<a name='L214'> 214 <i><font color='green'>   Modifying a hash table H during iteration, using any of the</font></i>
<a name='L215'> 215 <i><font color='green'>   functions hash_clear(), hash_destroy(), hash_insert(),</font></i>
<a name='L216'> 216 <i><font color='green'>   hash_replace(), or hash_delete(), invalidates all</font></i>
<a name='L217'> 217 <i><font color='green'>   iterators. */</font></i>
<a name='L218'> 218 <b>struct</b> <a href='../S/108.html#L29' title='Defined at 29 in src/lib/kernel/hash.h.'>hash_elem</a> *
<a name='L219'> 219 <a href='../S/108.html#L91' title='Refered from 91 in src/lib/kernel/hash.h.'>hash_next</a> (<b>struct</b> hash_iterator *i)
<a name='L220'> 220 <font color='red'>{</font>
<a name='L221'> 221   <a href='../S/104.html#L37' title='Defined at 37 in src/lib/debug.h.'>ASSERT</a> (i != <a href='../S/92.html#L4' title='Defined at 4 in src/lib/stddef.h.'>NULL</a>);
<a name='L222'> 222 
<a name='L223'> 223   i-&gt;elem = <a href='../S/113.html#L12' title='Defined at 12 in src/lib/kernel/hash.c.'>list_elem_to_hash_elem</a> (<a href='../S/112.html#L82' title='Defined at 82 in src/lib/kernel/list.c.'>list_next</a> (&amp;i-&gt;elem-&gt;<a href='../S/107.html#L90' title='Defined at 90 in src/lib/kernel/list.h.'>list_elem</a>));
<a name='L224'> 224   <b>while</b> (i-&gt;elem == <a href='../S/113.html#L12' title='Defined at 12 in src/lib/kernel/hash.c.'>list_elem_to_hash_elem</a> (<a href='../S/112.html#L94' title='Defined at 94 in src/lib/kernel/list.c.'>list_end</a> (i-&gt;bucket)))
<a name='L225'> 225     <font color='red'>{</font>
<a name='L226'> 226       <b>if</b> (++i-&gt;bucket &gt;= i-&gt;<a href='../S/108.html#L59' title='Defined at 59 in src/lib/kernel/hash.h.'>hash</a>-&gt;buckets + i-&gt;<a href='../S/108.html#L59' title='Defined at 59 in src/lib/kernel/hash.h.'>hash</a>-&gt;bucket_cnt)
<a name='L227'> 227         <font color='red'>{</font>
<a name='L228'> 228           i-&gt;elem = <a href='../S/92.html#L4' title='Defined at 4 in src/lib/stddef.h.'>NULL</a>;
<a name='L229'> 229           <b>break</b>;
<a name='L230'> 230         <font color='red'>}</font>
<a name='L231'> 231       i-&gt;elem = <a href='../S/113.html#L12' title='Defined at 12 in src/lib/kernel/hash.c.'>list_elem_to_hash_elem</a> (<a href='../S/112.html#L72' title='Defined at 72 in src/lib/kernel/list.c.'>list_begin</a> (i-&gt;bucket));
<a name='L232'> 232     <font color='red'>}</font>
<a name='L233'> 233   
<a name='L234'> 234   <b>return</b> i-&gt;elem;
<a name='L235'> 235 <font color='red'>}</font>
<a name='L236'> 236 
<a name='L237'> 237 <i><font color='green'>/* Returns the current element in the hash table iteration, or a</font></i>
<a name='L238'> 238 <i><font color='green'>   null pointer at the end of the table.  Undefined behavior</font></i>
<a name='L239'> 239 <i><font color='green'>   after calling hash_first() but before hash_next(). */</font></i>
<a name='L240'> 240 <b>struct</b> <a href='../S/108.html#L29' title='Defined at 29 in src/lib/kernel/hash.h.'>hash_elem</a> *
<a name='L241'> 241 <a href='../S/108.html#L92' title='Refered from 92 in src/lib/kernel/hash.h.'>hash_cur</a> (<b>struct</b> hash_iterator *i) 
<a name='L242'> 242 <font color='red'>{</font>
<a name='L243'> 243   <b>return</b> i-&gt;elem;
<a name='L244'> 244 <font color='red'>}</font>
<a name='L245'> 245 
<a name='L246'> 246 <i><font color='green'>/* Returns the number of elements in H. */</font></i>
<a name='L247'> 247 <a href='../S/92.html#L10' title='Defined at 10 in src/lib/stddef.h.'>size_t</a>
<a name='L248'> 248 <a href='../S/108.html#L95' title='Refered from 95 in src/lib/kernel/hash.h.'>hash_size</a> (<b>struct</b> hash *h) 
<a name='L249'> 249 <font color='red'>{</font>
<a name='L250'> 250   <b>return</b> h-&gt;<a href='../S/114.html#L51' title='Defined at 51 in src/lib/kernel/bitmap.c.'>elem_cnt</a>;
<a name='L251'> 251 <font color='red'>}</font>
<a name='L252'> 252 
<a name='L253'> 253 <i><font color='green'>/* Returns true if H contains no elements, false otherwise. */</font></i>
<a name='L254'> 254 <a href='../S/78.html#L4' title='Defined at 4 in src/lib/stdbool.h.'>bool</a>
<a name='L255'> 255 <a href='../S/108.html#L96' title='Refered from 96 in src/lib/kernel/hash.h.'>hash_empty</a> (<b>struct</b> hash *h) 
<a name='L256'> 256 <font color='red'>{</font>
<a name='L257'> 257   <b>return</b> h-&gt;<a href='../S/114.html#L51' title='Defined at 51 in src/lib/kernel/bitmap.c.'>elem_cnt</a> == 0;
<a name='L258'> 258 <font color='red'>}</font>
<a name='L259'> 259 
<a name='L260'> 260 <i><font color='green'>/* Fowler-Noll-Vo hash constants, for 32-bit word sizes. */</font></i>
<a name='L261'> 261 <font color='darkred'>#define</font> <a href='../R/63.html' title='Multiple refered from 2 places.'>FNV_32_PRIME</a> 16777619u
<a name='L262'> 262 <font color='darkred'>#define</font> <a href='../R/62.html' title='Multiple refered from 2 places.'>FNV_32_BASIS</a> 2166136261u
<a name='L263'> 263 
<a name='L264'> 264 <i><font color='green'>/* Returns a hash of the SIZE bytes in BUF. */</font></i>
<a name='L265'> 265 <b>unsigned</b>
<a name='L266'> 266 <a href='../R/476.html' title='Multiple refered from 2 places.'>hash_bytes</a> (<b>const</b> <b>void</b> *buf_, <a href='../S/92.html#L10' title='Defined at 10 in src/lib/stddef.h.'>size_t</a> size)
<a name='L267'> 267 <font color='red'>{</font>
<a name='L268'> 268   <i><font color='green'>/* Fowler-Noll-Vo 32-bit hash, for bytes. */</font></i>
<a name='L269'> 269   <b>const</b> <b>unsigned</b> <b>char</b> *buf = buf_;
<a name='L270'> 270   <b>unsigned</b> <a href='../S/108.html#L59' title='Defined at 59 in src/lib/kernel/hash.h.'>hash</a>;
<a name='L271'> 271 
<a name='L272'> 272   <a href='../S/104.html#L37' title='Defined at 37 in src/lib/debug.h.'>ASSERT</a> (buf != <a href='../S/92.html#L4' title='Defined at 4 in src/lib/stddef.h.'>NULL</a>);
<a name='L273'> 273 
<a name='L274'> 274   <a href='../S/108.html#L59' title='Defined at 59 in src/lib/kernel/hash.h.'>hash</a> = <a href='../S/113.html#L262' title='Defined at 262 in src/lib/kernel/hash.c.'>FNV_32_BASIS</a>;
<a name='L275'> 275   <b>while</b> (size-- &gt; 0)
<a name='L276'> 276     <a href='../S/108.html#L59' title='Defined at 59 in src/lib/kernel/hash.h.'>hash</a> = (<a href='../S/108.html#L59' title='Defined at 59 in src/lib/kernel/hash.h.'>hash</a> * <a href='../S/113.html#L261' title='Defined at 261 in src/lib/kernel/hash.c.'>FNV_32_PRIME</a>) ^ *buf++;
<a name='L277'> 277 
<a name='L278'> 278   <b>return</b> <a href='../S/108.html#L59' title='Defined at 59 in src/lib/kernel/hash.h.'>hash</a>;
<a name='L279'> 279 <font color='red'>}</font> 
<a name='L280'> 280 
<a name='L281'> 281 <i><font color='green'>/* Returns a hash of string S. */</font></i>
<a name='L282'> 282 <b>unsigned</b>
<a name='L283'> 283 <a href='../S/108.html#L100' title='Refered from 100 in src/lib/kernel/hash.h.'>hash_string</a> (<b>const</b> <b>char</b> *s_) 
<a name='L284'> 284 <font color='red'>{</font>
<a name='L285'> 285   <b>const</b> <b>unsigned</b> <b>char</b> *s = (<b>const</b> <b>unsigned</b> <b>char</b> *) s_;
<a name='L286'> 286   <b>unsigned</b> <a href='../S/108.html#L59' title='Defined at 59 in src/lib/kernel/hash.h.'>hash</a>;
<a name='L287'> 287 
<a name='L288'> 288   <a href='../S/104.html#L37' title='Defined at 37 in src/lib/debug.h.'>ASSERT</a> (s != <a href='../S/92.html#L4' title='Defined at 4 in src/lib/stddef.h.'>NULL</a>);
<a name='L289'> 289 
<a name='L290'> 290   <a href='../S/108.html#L59' title='Defined at 59 in src/lib/kernel/hash.h.'>hash</a> = <a href='../S/113.html#L262' title='Defined at 262 in src/lib/kernel/hash.c.'>FNV_32_BASIS</a>;
<a name='L291'> 291   <b>while</b> (*s != '\0')
<a name='L292'> 292     <a href='../S/108.html#L59' title='Defined at 59 in src/lib/kernel/hash.h.'>hash</a> = (<a href='../S/108.html#L59' title='Defined at 59 in src/lib/kernel/hash.h.'>hash</a> * <a href='../S/113.html#L261' title='Defined at 261 in src/lib/kernel/hash.c.'>FNV_32_PRIME</a>) ^ *s++;
<a name='L293'> 293 
<a name='L294'> 294   <b>return</b> <a href='../S/108.html#L59' title='Defined at 59 in src/lib/kernel/hash.h.'>hash</a>;
<a name='L295'> 295 <font color='red'>}</font>
<a name='L296'> 296 
<a name='L297'> 297 <i><font color='green'>/* Returns a hash of integer I. */</font></i>
<a name='L298'> 298 <b>unsigned</b>
<a name='L299'> 299 <a href='../S/108.html#L101' title='Refered from 101 in src/lib/kernel/hash.h.'>hash_int</a> (<b>int</b> i) 
<a name='L300'> 300 <font color='red'>{</font>
<a name='L301'> 301   <b>return</b> <a href='../S/113.html#L266' title='Defined at 266 in src/lib/kernel/hash.c.'>hash_bytes</a> (&amp;i, <b>sizeof</b> i);
<a name='L302'> 302 <font color='red'>}</font>
<a name='L303'> 303 
<a name='L304'> 304 <i><font color='green'>/* Returns the bucket in H that E belongs in. */</font></i>
<a name='L305'> 305 <b>static</b> <b>struct</b> <a href='../S/107.html#L97' title='Defined at 97 in src/lib/kernel/list.h.'>list</a> *
<a name='L306'> 306 <a href='../R/447.html' title='Multiple refered from 6 places.'>find_bucket</a> (<b>struct</b> hash *h, <b>struct</b> hash_elem *e) 
<a name='L307'> 307 <font color='red'>{</font>
<a name='L308'> 308   <a href='../S/92.html#L10' title='Defined at 10 in src/lib/stddef.h.'>size_t</a> bucket_idx = h-&gt;<a href='../S/108.html#L59' title='Defined at 59 in src/lib/kernel/hash.h.'>hash</a> (e, h-&gt;aux) &amp; (h-&gt;bucket_cnt - 1);
<a name='L309'> 309   <b>return</b> &amp;h-&gt;buckets[bucket_idx];
<a name='L310'> 310 <font color='red'>}</font>
<a name='L311'> 311 
<a name='L312'> 312 <i><font color='green'>/* Searches BUCKET in H for a hash element equal to E.  Returns</font></i>
<a name='L313'> 313 <i><font color='green'>   it if found or a null pointer otherwise. */</font></i>
<a name='L314'> 314 <b>static</b> <b>struct</b> <a href='../S/108.html#L29' title='Defined at 29 in src/lib/kernel/hash.h.'>hash_elem</a> *
<a name='L315'> 315 <a href='../R/449.html' title='Multiple refered from 5 places.'>find_elem</a> (<b>struct</b> hash *h, <b>struct</b> list *bucket, <b>struct</b> hash_elem *e) 
<a name='L316'> 316 <font color='red'>{</font>
<a name='L317'> 317   <b>struct</b> <a href='../S/107.html#L90' title='Defined at 90 in src/lib/kernel/list.h.'>list_elem</a> *i;
<a name='L318'> 318 
<a name='L319'> 319   <b>for</b> (i = <a href='../S/112.html#L72' title='Defined at 72 in src/lib/kernel/list.c.'>list_begin</a> (bucket); i != <a href='../S/112.html#L94' title='Defined at 94 in src/lib/kernel/list.c.'>list_end</a> (bucket); i = <a href='../S/112.html#L82' title='Defined at 82 in src/lib/kernel/list.c.'>list_next</a> (i)) 
<a name='L320'> 320     <font color='red'>{</font>
<a name='L321'> 321       <b>struct</b> <a href='../S/108.html#L29' title='Defined at 29 in src/lib/kernel/hash.h.'>hash_elem</a> *hi = <a href='../S/113.html#L12' title='Defined at 12 in src/lib/kernel/hash.c.'>list_elem_to_hash_elem</a> (i);
<a name='L322'> 322       <b>if</b> (!h-&gt;less (hi, e, h-&gt;aux) &amp;&amp; !h-&gt;less (e, hi, h-&gt;aux))
<a name='L323'> 323         <b>return</b> hi; 
<a name='L324'> 324     <font color='red'>}</font>
<a name='L325'> 325   <b>return</b> <a href='../S/92.html#L4' title='Defined at 4 in src/lib/stddef.h.'>NULL</a>;
<a name='L326'> 326 <font color='red'>}</font>
<a name='L327'> 327 
<a name='L328'> 328 <i><font color='green'>/* Returns X with its lowest-order bit set to 1 turned off. */</font></i>
<a name='L329'> 329 <b>static</b> <b>inline</b> <a href='../S/92.html#L10' title='Defined at 10 in src/lib/stddef.h.'>size_t</a>
<a name='L330'> 330 <a href='../R/933.html' title='Multiple refered from 2 places.'>turn_off_least_1bit</a> (<a href='../S/92.html#L10' title='Defined at 10 in src/lib/stddef.h.'>size_t</a> x) 
<a name='L331'> 331 <font color='red'>{</font>
<a name='L332'> 332   <b>return</b> x &amp; (x - 1);
<a name='L333'> 333 <font color='red'>}</font>
<a name='L334'> 334 
<a name='L335'> 335 <i><font color='green'>/* Returns true if X is a power of 2, otherwise false. */</font></i>
<a name='L336'> 336 <b>static</b> <b>inline</b> <a href='../S/92.html#L10' title='Defined at 10 in src/lib/stddef.h.'>size_t</a>
<a name='L337'> 337 <a href='../S/113.html#L371' title='Refered from 371 in src/lib/kernel/hash.c.'>is_power_of_2</a> (<a href='../S/92.html#L10' title='Defined at 10 in src/lib/stddef.h.'>size_t</a> x) 
<a name='L338'> 338 <font color='red'>{</font>
<a name='L339'> 339   <b>return</b> x != 0 &amp;&amp; <a href='../S/113.html#L330' title='Defined at 330 in src/lib/kernel/hash.c.'>turn_off_least_1bit</a> (x) == 0;
<a name='L340'> 340 <font color='red'>}</font>
<a name='L341'> 341 
<a name='L342'> 342 <i><font color='green'>/* Element per bucket ratios. */</font></i>
<a name='L343'> 343 <font color='darkred'>#define</font> MIN_ELEMS_PER_BUCKET  1 <i><font color='green'>/* Elems/bucket &lt; 1: reduce # of buckets. */</font></i>
<a name='L344'> 344 <font color='darkred'>#define</font> <a href='../S/113.html#L368' title='Refered from 368 in src/lib/kernel/hash.c.'>BEST_ELEMS_PER_BUCKET</a> 2 <i><font color='green'>/* Ideal elems/bucket. */</font></i>
<a name='L345'> 345 <font color='darkred'>#define</font> MAX_ELEMS_PER_BUCKET  4 <i><font color='green'>/* Elems/bucket &gt; 4: increase # of buckets. */</font></i>
<a name='L346'> 346 
<a name='L347'> 347 <i><font color='green'>/* Changes the number of buckets in hash table H to match the</font></i>
<a name='L348'> 348 <i><font color='green'>   ideal.  This function can fail because of an out-of-memory</font></i>
<a name='L349'> 349 <i><font color='green'>   condition, but that'll just make hash accesses less efficient;</font></i>
<a name='L350'> 350 <i><font color='green'>   we can still continue. */</font></i>
<a name='L351'> 351 <b>static</b> <b>void</b>
<a name='L352'> 352 <a href='../R/770.html' title='Multiple refered from 4 places.'>rehash</a> (<b>struct</b> hash *h) 
<a name='L353'> 353 <font color='red'>{</font>
<a name='L354'> 354   <a href='../S/92.html#L10' title='Defined at 10 in src/lib/stddef.h.'>size_t</a> old_bucket_cnt, new_bucket_cnt;
<a name='L355'> 355   <b>struct</b> <a href='../S/107.html#L97' title='Defined at 97 in src/lib/kernel/list.h.'>list</a> *new_buckets, *old_buckets;
<a name='L356'> 356   <a href='../S/92.html#L10' title='Defined at 10 in src/lib/stddef.h.'>size_t</a> i;
<a name='L357'> 357 
<a name='L358'> 358   <a href='../S/104.html#L37' title='Defined at 37 in src/lib/debug.h.'>ASSERT</a> (h != <a href='../S/92.html#L4' title='Defined at 4 in src/lib/stddef.h.'>NULL</a>);
<a name='L359'> 359 
<a name='L360'> 360   <i><font color='green'>/* Save old bucket info for later use. */</font></i>
<a name='L361'> 361   old_buckets = h-&gt;buckets;
<a name='L362'> 362   old_bucket_cnt = h-&gt;bucket_cnt;
<a name='L363'> 363 
<a name='L364'> 364   <i><font color='green'>/* Calculate the number of buckets to use now.</font></i>
<a name='L365'> 365 <i><font color='green'>     We want one bucket for about every BEST_ELEMS_PER_BUCKET.</font></i>
<a name='L366'> 366 <i><font color='green'>     We must have at least four buckets, and the number of</font></i>
<a name='L367'> 367 <i><font color='green'>     buckets must be a power of 2. */</font></i>
<a name='L368'> 368   new_bucket_cnt = h-&gt;<a href='../S/114.html#L51' title='Defined at 51 in src/lib/kernel/bitmap.c.'>elem_cnt</a> / <a href='../S/113.html#L344' title='Defined at 344 in src/lib/kernel/hash.c.'>BEST_ELEMS_PER_BUCKET</a>;
<a name='L369'> 369   <b>if</b> (new_bucket_cnt &lt; 4)
<a name='L370'> 370     new_bucket_cnt = 4;
<a name='L371'> 371   <b>while</b> (!<a href='../S/113.html#L337' title='Defined at 337 in src/lib/kernel/hash.c.'>is_power_of_2</a> (new_bucket_cnt))
<a name='L372'> 372     new_bucket_cnt = <a href='../S/113.html#L330' title='Defined at 330 in src/lib/kernel/hash.c.'>turn_off_least_1bit</a> (new_bucket_cnt);
<a name='L373'> 373 
<a name='L374'> 374   <i><font color='green'>/* Don't do anything if the bucket count wouldn't change. */</font></i>
<a name='L375'> 375   <b>if</b> (new_bucket_cnt == old_bucket_cnt)
<a name='L376'> 376     <b>return</b>;
<a name='L377'> 377 
<a name='L378'> 378   <i><font color='green'>/* Allocate new buckets and initialize them as empty. */</font></i>
<a name='L379'> 379   new_buckets = <a href='../S/161.html#L90' title='Defined at 90 in src/threads/malloc.c.'>malloc</a> (<b>sizeof</b> *new_buckets * new_bucket_cnt);
<a name='L380'> 380   <b>if</b> (new_buckets == <a href='../S/92.html#L4' title='Defined at 4 in src/lib/stddef.h.'>NULL</a>) 
<a name='L381'> 381     <font color='red'>{</font>
<a name='L382'> 382       <i><font color='green'>/* Allocation failed.  This means that use of the hash table will</font></i>
<a name='L383'> 383 <i><font color='green'>         be less efficient.  However, it is still usable, so</font></i>
<a name='L384'> 384 <i><font color='green'>         there's no reason for it to be an error. */</font></i>
<a name='L385'> 385       <b>return</b>;
<a name='L386'> 386     <font color='red'>}</font>
<a name='L387'> 387   <b>for</b> (i = 0; i &lt; new_bucket_cnt; i++) 
<a name='L388'> 388     <a href='../S/112.html#L61' title='Defined at 61 in src/lib/kernel/list.c.'>list_init</a> (&amp;new_buckets[i]);
<a name='L389'> 389 
<a name='L390'> 390   <i><font color='green'>/* Install new bucket info. */</font></i>
<a name='L391'> 391   h-&gt;buckets = new_buckets;
<a name='L392'> 392   h-&gt;bucket_cnt = new_bucket_cnt;
<a name='L393'> 393 
<a name='L394'> 394   <i><font color='green'>/* Move each old element into the appropriate new bucket. */</font></i>
<a name='L395'> 395   <b>for</b> (i = 0; i &lt; old_bucket_cnt; i++) 
<a name='L396'> 396     <font color='red'>{</font>
<a name='L397'> 397       <b>struct</b> <a href='../S/107.html#L97' title='Defined at 97 in src/lib/kernel/list.h.'>list</a> *old_bucket;
<a name='L398'> 398       <b>struct</b> <a href='../S/107.html#L90' title='Defined at 90 in src/lib/kernel/list.h.'>list_elem</a> *elem, *<a href='../S/135.html#L79' title='Defined at 79 in src/devices/intq.c.'>next</a>;
<a name='L399'> 399 
<a name='L400'> 400       old_bucket = &amp;old_buckets[i];
<a name='L401'> 401       <b>for</b> (elem = <a href='../S/112.html#L72' title='Defined at 72 in src/lib/kernel/list.c.'>list_begin</a> (old_bucket);
<a name='L402'> 402            elem != <a href='../S/112.html#L94' title='Defined at 94 in src/lib/kernel/list.c.'>list_end</a> (old_bucket); elem = <a href='../S/135.html#L79' title='Defined at 79 in src/devices/intq.c.'>next</a>) 
<a name='L403'> 403         <font color='red'>{</font>
<a name='L404'> 404           <b>struct</b> <a href='../S/107.html#L97' title='Defined at 97 in src/lib/kernel/list.h.'>list</a> *new_bucket
<a name='L405'> 405             = <a href='../S/113.html#L306' title='Defined at 306 in src/lib/kernel/hash.c.'>find_bucket</a> (h, <a href='../S/113.html#L12' title='Defined at 12 in src/lib/kernel/hash.c.'>list_elem_to_hash_elem</a> (elem));
<a name='L406'> 406           <a href='../S/135.html#L79' title='Defined at 79 in src/devices/intq.c.'>next</a> = <a href='../S/112.html#L82' title='Defined at 82 in src/lib/kernel/list.c.'>list_next</a> (elem);
<a name='L407'> 407           <a href='../S/112.html#L249' title='Defined at 249 in src/lib/kernel/list.c.'>list_remove</a> (elem);
<a name='L408'> 408           <a href='../S/112.html#L209' title='Defined at 209 in src/lib/kernel/list.c.'>list_push_front</a> (new_bucket, elem);
<a name='L409'> 409         <font color='red'>}</font>
<a name='L410'> 410     <font color='red'>}</font>
<a name='L411'> 411 
<a name='L412'> 412   <a href='../S/161.html#L219' title='Defined at 219 in src/threads/malloc.c.'>free</a> (old_buckets);
<a name='L413'> 413 <font color='red'>}</font>
<a name='L414'> 414 
<a name='L415'> 415 <i><font color='green'>/* Inserts E into BUCKET (in hash table H). */</font></i>
<a name='L416'> 416 <b>static</b> <b>void</b>
<a name='L417'> 417 <a href='../R/529.html' title='Multiple refered from 3 places.'>insert_elem</a> (<b>struct</b> hash *h, <b>struct</b> list *bucket, <b>struct</b> hash_elem *e) 
<a name='L418'> 418 <font color='red'>{</font>
<a name='L419'> 419   h-&gt;<a href='../S/114.html#L51' title='Defined at 51 in src/lib/kernel/bitmap.c.'>elem_cnt</a>++;
<a name='L420'> 420   <a href='../S/112.html#L209' title='Defined at 209 in src/lib/kernel/list.c.'>list_push_front</a> (bucket, &amp;e-&gt;<a href='../S/107.html#L90' title='Defined at 90 in src/lib/kernel/list.h.'>list_elem</a>);
<a name='L421'> 421 <font color='red'>}</font>
<a name='L422'> 422 
<a name='L423'> 423 <i><font color='green'>/* Removes E from hash table H. */</font></i>
<a name='L424'> 424 <b>static</b> <b>void</b>
<a name='L425'> 425 <a href='../R/774.html' title='Multiple refered from 3 places.'>remove_elem</a> (<b>struct</b> hash *h, <b>struct</b> hash_elem *e) 
<a name='L426'> 426 <font color='red'>{</font>
<a name='L427'> 427   h-&gt;<a href='../S/114.html#L51' title='Defined at 51 in src/lib/kernel/bitmap.c.'>elem_cnt</a>--;
<a name='L428'> 428   <a href='../S/112.html#L249' title='Defined at 249 in src/lib/kernel/list.c.'>list_remove</a> (&amp;e-&gt;<a href='../S/107.html#L90' title='Defined at 90 in src/lib/kernel/list.h.'>list_elem</a>);
<a name='L429'> 429 <font color='red'>}</font>
<a name='L430'> 430 
</pre>
<hr>
<a name='BOTTOM'>
<i><font color='green'>/* [&lt;][&gt;]<a href='#L25'>[^]</a><a href='#L425'>[v]</a><a href='#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</font></i>
</body>
</html>
